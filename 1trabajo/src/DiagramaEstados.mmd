---
title: Máquina de Café - Diagrama de Estados
---
stateDiagram-v2

    [*] --> Idle

    Idle --> Error : "Error inesperado"
    ComprobandoRecursos --> Error
    PreparandoCafe --> Error : "Fallo durante preparación":::errorArrow
    Sirviendo --> Error : "Fallo durante servicio"
    EchandoVaso --> Error
    Limpiando --> Error

    state Error {
        [*] --> MostrandoError
        MostrandoError --> Limpiando : "Reiniciar tras error"
    }

    note right of Error
        Estado de error. Todas las fallas llevan aquí.
    end note

    state Idle {
        [*] --> EsperandoOrden
        EsperandoOrden --> ComprobandoRecursos : "Usuario pide café"
        EsperandoOrden --> Error : "Error inesperado"
    }

    state ComprobandoRecursos {
        [*] --> VerificandoAgua
        VerificandoAgua --> VerificandoAzucar : "Agua disponible"
        VerificandoAgua --> Error : "No hay agua"
        VerificandoAgua --> Error : "Fallo al verificar agua"

        VerificandoAzucar --> RecursosOK : "Azúcar disponible o no requerida"
        VerificandoAzucar --> Error : "Fallo al verificar azúcar"
    }

    RecursosOK --> PreparandoCafe : "Iniciar preparación"

    state PreparandoCafe {
        [*] --> DecidiendoAzucar
        DecidiendoAzucar --> ConAzucar : "Usuario quiere azúcar"
        DecidiendoAzucar --> SinAzucar : "Sin azúcar"

        ConAzucar --> Sirviendo : "Azúcar añadido"
        ConAzucar --> Error : "Fallo al añadir azúcar"

        SinAzucar --> Sirviendo : "Preparando café sin azúcar"
    }

    Sirviendo --> EchandoVaso : "Café listo (Nescafé)"
    Sirviendo --> Error : "Fallo durante servicio"

    state EchandoVaso {
        [*] --> EsperandoVaso
        EsperandoVaso --> Limpiando : "Vaso colocado"
        EsperandoVaso --> Error : "Fallo al colocar vaso"
    }

    Limpiando --> Idle : "Limpieza completada"
    Limpiando --> Error : "Fallo al limpiar"

    note right of Idle
        Estado inicial. Espera orden para hacer café.
    end note

